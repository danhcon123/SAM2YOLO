<!DOCTYPE html>
<html lang="en">
<head>
    <meta chartset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annotating first frame</title>
    <style>

    /*Basic styling for the button*/
            /* General button styling */
        .styled-button {
            font-size: 16px;
            background-color: #00796B;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            display: inline-block;
            margin-top: 10px;
        }
    
        /* Hover effect for all buttons */
        .styled-button:hover {
            background-color: #0097A7;
        }
        /*Diable effect*/
        .styled-button:disabled{
            background-color: #636363;
        }
        
        /*Header*/
        header {
            display: flex;
            flex-direction: column;
            align-items: left; /* Center the button horizontally */
            padding: 5px;
            width: 100%;
            font-family: 'Arial', sans-serif; /* Use Arial font */
            color: white; /*Text color*/
            background-color: #00796B;
        }
    
        .header-content {
            display: flex;
            flex-direction: row;
            align-items: left; /* Vertically center image and text */
            justify-content: left;
            width: 100%;
        }
    
        .header-content img {
            max-width: 100px; /* Adjust size of the image if needed */
            height: 100px;
            margin-right: 20px; /* Add space between image and text */
        }
    
        .header-text {
            text-align: left; /* Align the text to the left */
        }
    
        /* General button styling */
        .header-buttons {
            display: flex;
            gap: 10px; /* Add spacing between buttons */
            justify-content: left;
            margin-top: flex;
        }
         
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        h2 {
            color: #00796B;
        }

        /*Image Area*/
        .main-frame-container{
            text-align: center;
            margin-bottom: 20px;
        }

        .main-frame{
            width: 1024px;
            height: 768px;
            border: 4px solid #0097A7
        }
        
        /*Add margin for the frame name*/
        .frame-name{
            margin-top: 10px;
            font-size: 18px;
            color: #00796B
        }

        .frame-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .frame-block {
            text-align: center;
            cursor: pointer;
        }

        .frame-block img {
            max-width: 150px;
            margin-bottom: 5px;
            border: 2px solid transparent;
            transition: border 0.2s;
        }

        .frame-block:hover img {
            border: 4px solid #00796B;
        }
        
        /* Highlight the chosen thumbnail */
        .frame-block.selected img {
            border: 4px solid #00796B;
        }
    </style>
</head>
<body>
    <header>
        <!-- Image and Text side by side -->
                <div class="header-content">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
                    <div class="header-text">
                        <h1>Ice Bear</h1>
                        <p>Annotating images and videos with the pros</p>
                    </div>
                </div>
        
            <!-- Buttons under image and text, horizontally aligned -->
                <div class="header-buttons">
                    <a href="/" class="styled-button">Home</a>
                    <a href="/about" class="styled-button">Refresh</a>
                    <a href="/contact" class="styled-button">Contact</a>
                </div>
    </header> 

    <h2>Select a Frame to Start Annotating</h2>


    <!-- Main Frame Display (1024x768) -->
    <div class="main-frame-container">
        <img id="mainFrame" class="main-frame" src="{{ url_for('get_frame', filename=frames[0])}}" alt="Main Frame">
        <p id="mainFrameName" class="frame-name">{{ frames[0] }}</p>
        <div class="styled-buttons">
        <<
            <button id="prevButton" class="styled-button">Previous</button>
            <button id="chooseButton" class="styled-button">Choose</button>
            <button id="nextButton" class="styled-button">Next</button>
        >>
        </div>
    </div>


    <!--Thumbnails of all frames-->
    <div class="frame-container">
        <!-- Loop through frames and display each frame with its "Choose" button-->
        {% for frame in frames %}
        <div class="frame-block">
            <img src="{{ url_for('get_frame', filename=frame)}}" alt="Frame" {{ loop.index0 }} onclick="setMainFrame('{{ frame }}')">
            <p class="frame-name">{{ frame }}</p>
        </div>
        {% endfor %}
    </div>


    <script>
        let currentIndex = 0;
        const frames = {{ frames | tojson }}; //List of frame filenames from Flask
        const mainFrameElement = document.getElementById('mainFrame');
        const mainFrameNameElement = document.getElementById('mainFrameName');
        
        
        //Update the main frame with the selected image
        function setMainFrame(frame){
            mainFrameElement.src = `/frames/${frame}`;
            mainFrameNameElement.textContent = frame;
            currentIndex = frames.indexOf(frame);
            // Remove highlight from all thumbnails
            document.querySelectorAll('.frame-block').forEach(function(block) {
                block.classList.remove('selected');
            });
            // Highlight the selected thumbnail
            document.getElementById(`frameBlock${index}`).classList.add('selected');
            //Scroll to the top of the page
            setTimeout(function(){
                window.scrollTo({
                    top:0,
                    behavior: 'smooth'
                });
            }, 100);
        }
        

        //Function to go to the previous frame
        document.getElementById('prevButton').addEventListener('click', function(){
            if (currentIndex>0) {
                currentIndex--;
            setMainFrame(frames[currentIndex]);
            }
            // Disable the previous button if it's at the first frame
            if (currentIndex === 0) {
                    document.getElementById('prevButton').disabled = true;
            }
            // Ensure the next button is enabled if we move backwards
            document.getElementById('nextButton').disabled = false;
        });
        

        //Function to go the next frame
        document.getElementById('nextButton').addEventListener('click', function(){
            if (currentIndex < frames.length -1 ) {
                currentIndex++;
            setMainFrame(frames[currentIndex]);
            }
            // Disable the next button if it's at the last frame
            if (currentIndex === frames.length - 1) {
                document.getElementById('nextButton').disabled = true;
            }
            // Ensure the previous button is enabled if we move forward
            document.getElementById('prevButton').disabled = false;
        });
        

        //Function to choose the current frame and proceed
        document.getElementById('chooseButton').addEventListener('click', function(){
            fetch('/choose_frame', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ frame: frames[currentIndex] })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success'){
                    alert(`You chose frame: ${data.chosen_frame}`);
                    //Redirect to the next step if needed
                    window.location.href = `/next_step?frame=${data.chosen_frame}`;
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
